{"version":3,"sources":["paginator.js"],"names":["Page","$paginator","pageNumber","conditionallyAppendHeader","$header","$margin","headerIndex","$headers","find","headerCount","length","eq","clone","hasClass","$","addClass","children","each","append","this","$page","prepend","setTimeout","$content","css","height","conditionallyAppendFooter","$footer","footerIndex","$footers","footerCount","data","getContentHeight","topHeight","Math","max","parseInt","bottomHeight","needsBreaking","setPageNumber","remove","fn","paginate","toClassSelector","classString","split","filter","string","trim","join","layoutContent","$model","pageBlockClass","$modelParent","parent","parents","pageDeletedClass","console","log","attr","removeClass","pageAddedClass","$modelParents","push","$pages","i","$view","orderContent","$children","$prevParent","$prev","prev","insertBefore","analyzePageBreaks","getPagesWithBreaks","pagesWithBreaks","forEach","contentHeight","pageHasBreaks","$contents","$this","position","top","pageContentLowerBoundary","splitContent","pageNumbers","toNextPage","hasPageBreak","pageMargin","unshift","shift","showAllPages","removeAttr","hideBlankPages","resetPageNumber","trigger","lastPageNumber","doRender","Error","onWatchChange","$modelWatch","modelObserver","MutationObserver","observe","childList","attributes","characterData","subtree"],"mappings":"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","file":"jquery-paginator.min.js","sourcesContent":["(function () {\n    var Page = function Page($paginator, pageNumber) {\n        var $page = $('<div>'),\n            $content = $('<div>'),\n            $margin = $('<div>');\n\n        $margin.addClass('margin');\n\n        pageNumber = pageNumber || $paginator.data('lastPageNumber');\n\n        $content\n            .addClass('content')\n            .append($margin);\n\n        function conditionallyAppendHeader() {\n            var $headers = $paginator.find('.model').find('.header'),\n                $header,\n                $margin,\n                headerIndex,\n                headerCount = $headers.length;\n\n            if (headerCount < 1) {\n                return;\n            }\n\n            headerIndex = pageNumber % headerCount;\n            $header = $headers.eq(headerIndex).clone(true, true);\n\n            if ($header.hasClass('terminal') && pageNumber > 0) {\n                return;\n            }\n\n            $margin = $('<div>');\n            $margin.addClass('margin');\n            $header.children().each(function () {\n                $margin.append(this);\n            });\n            $header.append($margin);\n            $page.prepend($header);\n            setTimeout(function () {\n                $content.css('margin-top', $header.height());\n            });\n        }\n\n        function conditionallyAppendFooter() {\n            var $footers = $paginator.find('.model').find('.footer'),\n                $footer,\n                footerIndex,\n                footerCount = $footers.length,\n                $margin;\n\n            if (footerCount < 1) {\n                return;\n            }\n\n            footerIndex = pageNumber % footerCount;\n            $footer = $footers.eq(footerIndex).clone(true, true);\n\n            if ($footer.hasClass('terminal') && pageNumber < $paginator.data('lastPageNumber') - 1) {\n                return;\n            }\n\n            $margin = $('<div>');\n            $margin.addClass('margin');\n            $footer.children().each(function () {\n                $margin.append(this);\n            });\n\n            $footer\n                .append($margin);\n\n            $page\n                .append($footer);\n\n            setTimeout(function () {\n                $content.css('margin-bottom', $footer.height());\n            });\n        }\n\n        $page.getContentHeight = function getContentHeight() {\n            var $header = this.find('.header'),\n                $footer = this.find('.footer'),\n                topHeight = Math.max($header.length > 0 ? $header.height() : 0, parseInt($margin.css('margin-top'))),\n                bottomHeight = Math.max($footer.length > 0 ? $footer.height() : 0, parseInt($margin.css('margin-top')));\n\n            return this.height() - topHeight - bottomHeight;\n        };\n\n        $page.needsBreaking = function needsBreaking() {\n            return $content.height() > this.getContentHeight();\n        };\n\n        $page.setPageNumber = function setPageNumber(pageNumber) {\n            this.data('pageNumber', pageNumber);\n\n            this.find('.header').remove();\n            this.find('.footer').remove();\n\n            conditionallyAppendHeader();\n            conditionallyAppendFooter();\n        };\n\n        $page\n            .addClass('page')\n            .append($content);\n\n        $page.setPageNumber(pageNumber);\n\n        return $page;\n    };\n\n    $.fn.paginate = function Paginator() {\n        var $paginator = this,\n            $model = $('<div>'),\n            $modelWatch = $('<div>'),\n            $view = $('<div>'),\n            modelObserver = new MutationObserver(onWatchChange),\n            lastPageNumber = 0,\n            $pages = [],\n            pageBlockClass = 'page-block',\n            pageAddedClass = 'page-added',\n            pageDeletedClass = 'page-deleted',\n            $modelParents = [];\n\n        function toClassSelector(classString) {\n            return '.' + classString.split(' ').filter(function (string) { return string.trim().length > 0 }).join('.');\n        }\n\n        function layoutContent() {\n            $model\n                .find(toClassSelector(pageBlockClass))\n                .each(function () {\n                    var $content = $(this),\n                        $modelParent = $content.parent();\n\n                    if ($content.parents(toClassSelector(pageDeletedClass)).length > 0) {\n                        return;\n                    }\n\n                    console.log($modelParent);\n\n                    $modelParent.attr('data-order', 0);\n                    $content\n                        .data('$modelParent', $modelParent)\n                        .removeClass(pageBlockClass)\n                        .addClass(pageAddedClass);\n                    $modelParents.push($modelParent);\n                    $pages[0].find('.content').find('.margin').append($content);\n                });\n\n            $model\n                .find('[data-order]')\n                .each(function (i) {\n                    $(this).attr('data-order', i);\n                });\n\n            $view\n                .find('.content')\n                .find('.margin')\n                .children()\n                .each(function () {\n                    var $content = $(this),\n                        $modelParent = $content.data('$modelParent');\n\n                    if (!$modelParent) {\n                        $content.remove();\n                        return;\n                    }\n\n                    if (!($modelParent.hasClass(pageDeletedClass) ||\n                        $modelParent.parents().length < 1 ||\n                        $modelParent.parents(toClassSelector(pageDeletedClass)).length > 0)) {\n                        //if ($content.css('float') === 'none') {\n                            $content.attr('data-order', $modelParent.attr('data-order'));\n                        //}\n                        return;\n                    }\n\n                    $content.remove();\n                });\n        }\n\n        function orderContent() {\n            var $children = $view.find('.content').find('.margin').children();\n\n            $children\n                .each(function () {\n                    var $content = $(this),\n                        $prev = $content.prev(),\n                        $modelParent,\n                        $prevParent;\n\n                    $modelParent = $content.data('$modelParent');\n\n                    if ($prev.length > 0) {\n                        $prevParent = $prev.data('$modelParent');\n                    }\n\n                    if (!$prevParent) {\n                        return;\n                    }\n\n                    if (parseInt($modelParent.attr('data-order')) < parseInt($prevParent.attr('data-order'))) {\n                        $content.insertBefore($prev);\n                    }\n                });\n        }\n\n        function analyzePageBreaks() {\n            var pagesWithBreaks;\n\n            function getPagesWithBreaks() {\n                var pagesWithBreaks = [];\n\n                $pages.forEach(function ($page, i) {\n                    var contentHeight = $page.getContentHeight(),\n                        pageHasBreaks = false,\n                        $contents = $page.find('.content').find('.margin').children();\n\n                    $contents.each(function () {\n                        var $this = $(this),\n                            position = $this.position().top,\n                            height = $this.height(),\n                            pageContentLowerBoundary = parseInt($page.find('.content').css('margin-top')) + contentHeight;\n\n                        pageHasBreaks = pageHasBreaks || position + height > pageContentLowerBoundary;\n                    });\n\n                    if (!pageHasBreaks) {\n                        $page.removeClass('-overflow');\n                        return;\n                    }\n\n                    $page.addClass('-overflow');\n                    pagesWithBreaks.push(i);\n                });\n\n                return pagesWithBreaks;\n            }\n\n            function splitContent(pageNumbers) {\n                pageNumbers.forEach(function (pageNumber, i) {\n                    var toNextPage = [],\n                        $page = $pages[pageNumber],\n                        contentHeight = $page.getContentHeight(),\n                        hasPageBreak = false;\n\n                    $page.find('.content').find('.margin').children().each(function () {\n                        var $this = $(this),\n                            position = $this.position().top,\n                            height = $this.height(),\n                            pageMargin = parseInt($page.find('.content').css('margin-top')),\n                            pageContentLowerBoundary = pageMargin + contentHeight;\n\n                        //hasPageBreak = hasPageBreak || $this.hasClass('page-break');\n\n                        //if ($this.hasClass('page-break') && (!$pages[pageNumber + 1] || $pages[pageNumber + 1 ].find('.content').find('.margin').children().length < 1)) {\n                        //    hasPageBreak = true;\n                        //    return;\n                        //}\n\n                        if (hasPageBreak || position + height > pageContentLowerBoundary) {\n                            toNextPage.unshift(this);\n                        }\n                    });\n\n                    while (toNextPage.length > 0) {\n                        if (!$pages[ pageNumber + 1 ]) {\n                            $view.append(\n                                $pages[ pageNumber + 1 ] = new Page($paginator, pageNumber + 1)\n                            );\n                        }\n                        $pages[ pageNumber + 1 ].find('.content').find('.margin').prepend(toNextPage.shift());\n                        $paginator.data('lastPageNumber', pageNumber + 1);\n                    }\n                });\n            }\n\n            do {\n                splitContent(pagesWithBreaks = getPagesWithBreaks());\n            } while (pagesWithBreaks.length > 0);\n        }\n\n        function showAllPages() {\n            $pages.forEach(function ($page, i) {\n                $page\n                    .removeAttr('hidden')\n                    .setPageNumber(i);\n            });\n        }\n\n        function hideBlankPages() {\n            $pages.forEach(function ($page, i) {\n                if ($page.find('.content').find('.margin').children().length > 0 || i < 1) {\n                    return;\n                }\n                $page.attr('hidden', '');\n            });\n        }\n\n        function resetPageNumber() {\n            $paginator.trigger('paginator.pagenumberchange', { lastPageNumber: lastPageNumber });\n            $paginator.data('lastPageNumber', $view.find('.page').length);\n        }\n\n        function doRender() {\n            $paginator.data('_isRendering', true);\n            resetPageNumber();\n            if (!$pages[lastPageNumber]) {\n                $view.append(\n                    $pages[lastPageNumber] = new Page($paginator, lastPageNumber)\n                );\n\n                if ($view.find('.page').css('height') === 'auto') {\n                    throw new Error('Page dimensions should be explicitly set up! Either you have not included the default style or pages\\' dimensions have been set to auto.');\n                }\n            }\n            showAllPages();\n            layoutContent();\n            orderContent();\n            analyzePageBreaks();\n            hideBlankPages();\n            setTimeout(function () {\n                $paginator.data('_isRendering', false);\n            });\n        }\n\n        function onWatchChange() {\n            if (!!$paginator.data('_isRendering')) {\n                return;\n            }\n\n            setTimeout(function () {\n                doRender();\n                setTimeout(function () {\n                    $paginator.trigger('paginator.modelchange', {});\n                });\n            });\n        }\n\n        $modelWatch\n            .addClass('watch')\n            .append($paginator.children());\n\n        modelObserver\n            .observe($modelWatch[0], {\n                childList: true,\n                attributes: true,\n                characterData: true,\n                subtree: true\n            });\n\n        $model\n            .addClass('model')\n            .append($modelWatch);\n\n        $view\n            .addClass('view')\n            .append($pages[0]);\n\n        $paginator\n            .addClass('paginator-component')\n            .append($model)\n            .append($view);\n\n        setTimeout(function () {\n            doRender();\n        });\n    };\n})();\n"]}