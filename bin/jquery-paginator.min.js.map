{"version":3,"sources":["paginator.js"],"names":["toClassSelector","classString","split","filter","string","trim","length","join","PaginatorOptions","rawOpts","PaginatorPageContent","klass","opts","createElement","self","$el","$","addClass","$margin","marginClass","append","page","this","clear","html","mountTo","parent","getBlocks","children","PaginatorPage","pageClass","header","content","footer","getContentHeight","$header","find","headerClass","$footer","footerClass","topHeight","Math","max","height","parseInt","css","bottomHeight","getContentLowerBoundary","view","contentClass","hasBreaks","getOverflowBlocks","$block","position","top","PaginatorRenderer","writePageComponents","pages","forEach","i","writeToBlockContainer","blocks","blockContainerIndex","model","getIndexForPage","isClone","each","$blockParent","$renderedBlock","clone","parents","pageDeletedClass","blockParentClass","attr","orderDataAttrName","data","parentDataAttrName","removeClass","pageBlockClass","pageAddedClass","firstPage","setOrder","checkDeletedBlocks","isParentDeleted","hasClass","remove","insertPageForContent","newPage","slice","pageIndex","addPage","getFirstPageWithBreak","pageToBreak","console","log","performPageBreaks","performAllPageBreaks","hasPerformedPageBreaks","renderContent","isRendering","setTimeout","render","PaginatorModel","modelClass","$watch","watchClass","getBlockContainers","isTerminal","terminalClass","getCount","getIndexForTerminalBlockContainer","pageNumber","j","hasHeaderTerminalClass","hasFooterTerminalClass","$currBlockContainer","eq","paginator","next","getPageCount","hasTerminalBlockContainer","$blockContainer","$blocks","getOrderedBlocks","PaginatorView","viewClass","addToPageList","isNaN","push","splice","Paginator","renderer","bindToElement","componentClass","unpaginatedClass","createModel","createView","createRenderer","observeModel","modelObserver","observe","childList","attributes","characterData","subtree","pub","MutationObserver","refresh","bindTo","fn","paginate"],"mappings":"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","file":"jquery-paginator.min.js","sourcesContent":["(function () {\n    var componentClass = 'paginator-component',\n        unpaginatedClass = 'paginator-unpaginated',\n        modelClass = 'model',\n        viewClass = 'view',\n        watchClass = 'watch',\n        pageClass = 'page',\n        pageBlockClass = 'page-block',\n        pageAddedClass = 'page-added',\n        pageDeletedClass = 'page-deleted',\n        contentClass = 'content',\n        headerClass = 'header',\n        footerClass = 'footer',\n        marginClass = 'margin',\n        parentDataAttrName = 'parent',\n        terminalClass = '-terminal',\n        blockParentClass = 'block-parent',\n        orderDataAttrName = 'data-order';\n\n    /**\n     * Converts a class string to a CSS selector.\n     * @param {string} classString The class string.\n     * @returns {string} The selector string.\n     */\n    function toClassSelector(classString) {\n        return '.' + classString.split(' ').filter(function (string) { return string.trim().length > 0 }).join('.');\n    }\n\n    /**\n     * Class for the options for the paginator.\n     * @param {object} rawOpts The raw options data.\n     * @constructor\n     */\n    function PaginatorOptions(rawOpts) {\n        return rawOpts;\n    }\n\n    /**\n     * Class for the container of contents on a page.\n     * @param {string} klass The class name of the main HTML element generated by the component.\n     * @param {PaginatorOptions} opts The options of the paginator.\n     * @constructor\n     */\n    function PaginatorPageContent(klass, opts) {\n        var self = this,\n            page;\n\n        /**\n         * Creates the elements of the component.\n         */\n        function createElement() {\n            self.$el = self.$el || $('<div>').addClass(klass);\n            self.$margin = self.$margin = $('<div>').addClass(marginClass);\n\n            self.$el.append(self.$margin);\n        }\n\n        /**\n         * Appends a content to this component.\n         * @param {jQuery} $el The element to append.\n         */\n        self.append = function append($el) {\n            self.$margin.append($el);\n        };\n\n        /**\n         *\n         */\n        self.clear = function clear() {\n            self.$margin.html('');\n        };\n\n        /**\n         * Mounts this component to a parent component.\n         * @param {object} parent The parent component.\n         */\n        self.mountTo = function mountTo(parent) {\n            if (page === parent) {\n                return;\n            }\n\n            page = parent;\n            page.$el.append(self.$el);\n        };\n\n        /**\n         * Gets the content blocks of this component.\n         * @returns {jQuery} The content blocks of this component.\n         */\n        self.getBlocks = function getBlocks() {\n            return self.$margin.children();\n        };\n\n        createElement();\n    }\n\n    /**\n     * Class for the page that is to be rendered in the paginator.\n     * @param {PaginatorOptions} opts The options of the paginator.\n     * @constructor\n     */\n    function PaginatorPage(opts) {\n        var self = this,\n            view;\n\n        self.header = new PaginatorPageContent(headerClass, opts);\n        self.content = new PaginatorPageContent(contentClass, opts);\n        self.footer = new PaginatorPageContent(footerClass, opts);\n\n        /**\n         * Creates the elements of the component.\n         */\n        function createElement() {\n            self.$el = self.$el || $('<div>').addClass(pageClass);\n            self.$el\n                .append(self.header.$el)\n                .append(self.content.$el)\n                .append(self.footer.$el);\n        }\n\n        /**\n         * Gets the content height of the page.\n         * @returns {number} The content height of the page.\n         */\n        function getContentHeight() {\n            var $header = self.$el.find(toClassSelector(headerClass)),\n                $footer = self.$el.find(toClassSelector(footerClass)),\n                $margin = self.content.$margin,\n                topHeight = Math.max($header.length > 0 ? $header.height() : 0, parseInt($margin.css('margin-top'))),\n                bottomHeight = Math.max($footer.length > 0 ? $footer.height() : 0, parseInt($margin.css('margin-bottom')));\n\n            return self.$el.height() - topHeight - bottomHeight;\n        }\n\n        /**\n         * Gets the lower boundary of the page.\n         * @returns {number} The lower boundary of the page.\n         */\n        function getContentLowerBoundary() {\n            return parseInt(self.content.$el.css('margin-top')) + getContentHeight();\n        }\n\n        /**\n         * Determines if the page has elements that can trigger page breaks.\n         * @returns {boolean}\n         */\n        self.hasBreaks = function hasBreaks() {\n            return self.getOverflowBlocks().length > 0;\n        };\n\n        /**\n         * Gets the elements that overflow the content area of the page.\n         * @returns {jQuery} The elements.\n         */\n        self.getOverflowBlocks = function getOverflowBlocks() {\n            return self.content.getBlocks()\n                .filter(function () {\n                    var $block = $(this),\n                        position = $block.position().top,\n                        height = $block.height();\n\n                    return position + height > getContentLowerBoundary();\n                });\n        };\n\n        /**\n         * Mounts the component to a parent.\n         * @param {object} parent The component\n         */\n        self.mountTo = function mountTo(parent) {\n            if (view === parent) {\n                return;\n            }\n\n            view = parent;\n            view.$el.append(self.$el);\n        };\n\n        createElement();\n    }\n\n    /**\n     * Class for the renderer of the paginator.\n     * @param {PaginatorOptions} opts\n     * @constructor\n     */\n    function PaginatorRenderer(opts) {\n        var self = this,\n            model,\n            view,\n            firstPage = new PaginatorPage(opts),\n            isRendering = false;\n\n        /**\n         * Writes the appropriate headers and the footers of the page.\n         */\n        function writePageComponents() {\n            view.pages.forEach(function (page, i) {\n                writeToBlockContainer(headerClass, page, i);\n                writeToBlockContainer(footerClass, page, i);\n            });\n        }\n\n        /**\n         * Writes the content of the page.\n         */\n        function writeToBlockContainer(klass, page, i) {\n            var blockContainerIndex = model.getIndexForPage(klass, i),\n                blocks,\n                isClone = false;\n\n            // TODO refactor this part of the code.\n\n            switch (klass) {\n                case footerClass:\n                    page.footer.clear();\n                    blocks = model.getBlocks(klass)(blockContainerIndex);\n                    isClone = true;\n                    break;\n                case headerClass:\n                    page.header.clear();\n                    blocks = model.getBlocks(klass)(blockContainerIndex);\n                    isClone = true;\n                    break;\n                default:\n                    blocks = model.getBlocks(klass);\n                    break;\n            }\n\n            blocks\n                .each(function () {\n                    var $block = $(this),\n                        $blockParent,\n                        $renderedBlock = $block;\n\n                    if (isClone) {\n                        $renderedBlock = $block.clone(true, true);\n                    }\n\n                    if ($block.parents(toClassSelector(pageDeletedClass)).length > 0) {\n                        return;\n                    }\n\n                    $blockParent = $block.parent();\n\n                    $blockParent\n                        .addClass(blockParentClass)\n                        .attr(orderDataAttrName, 0);\n\n                    $renderedBlock\n                        .data(parentDataAttrName, $blockParent)\n                        .removeClass(pageBlockClass)\n                        .addClass(pageAddedClass);\n\n                    switch (klass) {\n                        case headerClass:\n                            page.header.append($renderedBlock);\n                            return;\n                        case footerClass:\n                            page.footer.append($renderedBlock);\n                            return;\n                        default:\n                            break;\n                    }\n\n                    firstPage.content.append($renderedBlock);\n                });\n\n            switch (klass) {\n                case headerClass:\n                    page.content.$margin.css('margin-top', page.$el.find(toClassSelector(klass)).height());\n                    break;\n                case footerClass:\n                    page.content.$margin.css('margin-bottom', page.$el.find(toClassSelector(klass)).height());\n                    break;\n                default:\n                    break;\n            }\n        }\n\n        /**\n         * Sets the ordering of each block rendered in the view.\n         */\n        function setOrder() {\n            model\n                .getBlocks('content')\n                .each(function (i) {\n                    $(this).attr(orderDataAttrName, i);\n                });\n        }\n\n        /**\n         * Checks the view for deleted blocks and performs the appropriate actions.\n         */\n        function checkDeletedBlocks() {\n            view\n                .getBlocks('content')\n                .each(function () {\n                    var $block = $(this),\n                        $blockParent,\n                        isParentDeleted;\n\n                    $blockParent = $block.data(parentDataAttrName);\n\n                    isParentDeleted = !$blockParent ||\n                            $blockParent.hasClass(pageDeletedClass) ||\n                            $blockParent.parents(toClassSelector(pageDeletedClass)).length > 0;\n\n                    if (!isParentDeleted) {\n                        return;\n                    }\n\n                    $block.remove();\n                });\n        }\n\n        /**\n         * Inserts a page for new content.\n         * @param {{blocks:jQuery,pageIndex:number}} content The content.\n         */\n        function insertPageForContent(content) {\n            var newPage = new PaginatorPage(opts);\n\n            content.blocks.each(function () {\n                newPage.content.append($(this));\n            });\n\n            view.pages.slice(content.pageIndex + 1).forEach(function (page) {\n                newPage.content.append(page.content.getBlocks());\n            });\n\n            view.addPage(newPage);\n        }\n\n        /**\n         * Gets the content of the first page that has a break.\n         * @returns {{blocks:jQuery,pageIndex:number}} The content to insert.\n         */\n        function getFirstPageWithBreak() {\n            var pageToBreak = null;\n\n            view.pages.forEach(function (page, i) {\n                if (!page.hasBreaks() || pageToBreak !== null) {\n                    return;\n                }\n\n                // Get the first page to have page breaks.\n                pageToBreak = {\n                    pageIndex: i,\n                    blocks: page.getOverflowBlocks()\n                };\n            });\n\n            console.log(pageToBreak);\n\n            return pageToBreak;\n        }\n\n        /**\n         * Performs page breaks among the view's pages.\n         * @returns {boolean} A value that determines if the renderer performed page breaks, which is used to repeat this method.\n         */\n        function performPageBreaks() {\n            var pageToBreak = getFirstPageWithBreak();\n\n            console.log(pageToBreak);\n\n            if (pageToBreak === null) {\n                return false;\n            }\n\n            insertPageForContent(pageToBreak);\n            return true;\n        }\n\n        /**\n         * Performs all page breaks when the renderer detects at least one page that has a page break.\n         */\n        function performAllPageBreaks() {\n            var hasPerformedPageBreaks;\n\n            do {\n                hasPerformedPageBreaks = performPageBreaks();\n            } while (hasPerformedPageBreaks);\n        }\n\n        /**\n         * Renders the content.\n         */\n        function renderContent() {\n            if (isRendering) {\n                return;\n            }\n\n            isRendering = true;\n            checkDeletedBlocks();\n            writeToBlockContainer(contentClass);\n            setOrder();\n            performAllPageBreaks();\n            writePageComponents();\n            // TODO perform page breaks when header and footer is displayed\n\n            setTimeout(function () {\n                isRendering = false;\n            });\n        }\n\n        /**\n         *\n         */\n        self.render = function render() {\n            if (view.pages.length < 1) {\n                view.addPage(firstPage);\n            }\n\n            renderContent();\n        };\n\n        /**\n         *\n         * @param parent\n         */\n        self.mountTo = function mountTo(parent) {\n            model = parent.model;\n            view = parent.view;\n\n            self.render();\n        };\n    }\n\n    /**\n     * Class for the model of the paginator.\n     * @param {PaginatorOptions} opts The options of the paginator.\n     * @constructor\n     */\n    function PaginatorModel(opts) {\n        var self = this,\n            paginator;\n\n        /**\n         *\n         */\n        function createElement() {\n            self.$el = self.$el || $('<div>').addClass(modelClass);\n            if (!!self.$watch) {\n                return;\n            }\n            self.$watch = self.$watch || $('<div>').addClass(watchClass);\n            self.$el.append(self.$watch);\n        }\n\n        /**\n         *\n         * @param klass\n         * @param isTerminal\n         * @returns {*}\n         */\n        function getBlockContainers(klass, isTerminal) {\n            return self.$watch.children(toClassSelector(!!isTerminal ? klass + ' ' + terminalClass : klass));\n        }\n\n        /**\n         *\n         * @param klass\n         * @returns {*}\n         */\n        function getCount(klass) {\n            return getBlockContainers(klass).length;\n        }\n\n        /**\n         *\n         * @param klass\n         * @param pageNumber\n         * @returns {number|*}\n         */\n        function getIndexForTerminalBlockContainer(klass, pageNumber) {\n            var $currBlockContainer = getBlockContainers(klass).eq(0),\n                i, j, hasHeaderTerminalClass, hasFooterTerminalClass;\n\n            for (\n                i = 0,\n                j = 0;\n\n                i < paginator.view.pages.length;\n\n                i++,\n                j = (j + 1) % getCount(headerClass),\n                $currBlockContainer = $currBlockContainer.next()\n            ) {\n                if (!$currBlockContainer) {\n                    $currBlockContainer = getBlockContainers(klass).eq(0);\n                }\n\n                hasHeaderTerminalClass = klass === headerClass && $currBlockContainer.hasClass(terminalClass);\n                hasFooterTerminalClass = klass === footerClass && $currBlockContainer.hasClass(terminalClass);\n\n                if (hasHeaderTerminalClass && pageNumber > 0 ||\n                    hasFooterTerminalClass && pageNumber < paginator.view.getPageCount() - 1) {\n                    ++j;\n                }\n\n                if (i === pageNumber ||\n                    hasHeaderTerminalClass && pageNumber === 0 ||\n                    hasFooterTerminalClass && pageNumber === paginator.view.getPageCount() - 1) {\n                    return j;\n                }\n            }\n        }\n\n        /**\n         *\n         * @param klass\n         * @returns {boolean}\n         */\n        self.hasTerminalBlockContainer = function hasTerminalBlockContainer(klass) {\n            return getBlockContainers(klass, true).length > 0;\n        };\n\n        /**\n         *\n         * @param klass\n         * @param pageNumber\n         * @returns {*}\n         */\n        self.getIndexForPage = function getIndexForPage(klass, pageNumber) {\n            if (!self.hasTerminalBlockContainer(klass)) {\n                return pageNumber % getCount(klass);\n            }\n\n            return getIndexForTerminalBlockContainer(klass, pageNumber);\n        };\n\n        /**\n         *\n         * @param klass\n         * @returns {*}\n         */\n        self.getBlocks = function getBlocks(klass) {\n            switch (klass) {\n                case headerClass:\n                case footerClass:\n                    return function (i) {\n                        var $blockContainer = getBlockContainers(klass).eq(i),\n\n                            isTerminal = $blockContainer.hasClass(terminalClass),\n                            $blocks = $blockContainer.find(toClassSelector(pageBlockClass));\n\n                        return isTerminal ?\n                            $blocks.addClass(terminalClass) :\n                            $blocks.removeClass(terminalClass);\n                    };\n                default:\n                    break;\n            }\n\n            return getBlockContainers(klass).find(toClassSelector(pageBlockClass));\n        };\n\n        /**\n         *\n         * @param klass\n         * @returns {*|{}}\n         */\n        self.getOrderedBlocks = function getOrderedBlocks(klass) {\n            return getBlockContainers(klass).find('[' + orderDataAttrName + ']');\n        };\n\n        /**\n         *\n         * @param parent\n         */\n        self.mountTo = function mountTo(parent) {\n            if (paginator === parent) {\n                return;\n            }\n\n            paginator = parent;\n            paginator.$el.append(self.$el);\n        };\n\n        createElement();\n    }\n\n    /**\n     * Class for the view of the paginator.\n     * @param {PaginatorOptions} opts The options of the paginator.\n     * @constructor\n     */\n    function PaginatorView(opts) {\n        var self = this,\n            paginator;\n\n        /**\n         *\n         * @type {Array}\n         */\n        self.pages = self.pages || [];\n\n        /**\n         *\n         */\n        function createElement() {\n            self.$el = self.$el || $('<div>').addClass(viewClass);\n        }\n\n        /**\n         *\n         * @param page\n         * @param i\n         */\n        function addToPageList(page, i) {\n            if (isNaN(i) || i === null) {\n                self.pages.push(page);\n                return;\n            }\n\n            self.pages.splice(i, 0, page);\n        }\n\n        /**\n         *\n         * @returns {Number}\n         */\n        self.getPageCount = function getPageCount() {\n            return self.pages.length;\n        };\n\n        /**\n         *\n         * @param klass\n         * @returns {XMLList}\n         */\n        self.getBlocks = function getBlocks(klass) {\n            return self.$el\n                .find(toClassSelector(klass))\n                .children(toClassSelector(marginClass))\n                .children();\n        };\n\n        /**\n         *\n         * @param page\n         * @param i\n         * @returns {*}\n         */\n        self.addPage = function addPage(page, i) {\n            addToPageList(page, i);\n            page.mountTo(self);\n            return page;\n        };\n\n        /**\n         *\n         * @param parent\n         */\n        self.mountTo = function mountTo(parent) {\n            paginator = parent;\n            paginator.$el.append(self.$el);\n        };\n\n        createElement();\n    }\n\n    /**\n     * Class for the paginator.\n     * @param {object} opts The options of the paginator.\n     * @constructor\n     */\n    function Paginator(opts) {\n        var self = this,\n            modelObserver,\n            pub;\n\n        opts = new PaginatorOptions(opts);\n\n        modelObserver = new MutationObserver(render);\n\n        /**\n         *\n         * @type {PaginatorModel}\n         */\n        self.model = new PaginatorModel(opts);\n\n        /**\n         *\n         * @type {PaginatorView}\n         */\n        self.view = new PaginatorView(opts);\n\n        /**\n         *\n         * @type {PaginatorRenderer}\n         */\n        self.renderer = new PaginatorRenderer(opts);\n\n        /**\n         *\n         */\n        function render() {\n            self.renderer.render();\n        }\n\n        /**\n         *\n         * @param $el\n         */\n        function bindToElement($el) {\n            if (!!self.$el) {\n                self.$el.removeClass(componentClass);\n            }\n            self.$el = $el;\n            if (self.$el.hasClass(componentClass)) {\n                return;\n            }\n            self.$el\n                .addClass(componentClass)\n                .removeClass(unpaginatedClass);\n        }\n\n        /**\n         *\n         */\n        function createModel() {\n            self.model.mountTo(self);\n\n            self.model.$watch.append(\n                self\n                    .$el\n                    .children()\n                    .filter(function () {\n                        var $el = $(this);\n\n                        return !(\n                            $el.hasClass(modelClass) ||\n                            $el.hasClass(viewClass) ||\n                            $el.hasClass(watchClass)\n                        );\n                    })\n            );\n        }\n\n        /**\n         *\n         */\n        function createView() {\n            self.view.mountTo(self);\n        }\n\n        /**\n         *\n         */\n        function createRenderer() {\n            self.renderer.mountTo(self);\n        }\n\n        /**\n         *\n         */\n        function observeModel() {\n            modelObserver\n                .observe(self.model.$watch[0], {\n                    childList: true,\n                    attributes: true,\n                    characterData: true,\n                    subtree: true\n                });\n        }\n\n        pub = {\n            refresh: function doRender() {\n                render();\n            }\n        };\n\n        /**\n         *\n         * @param $el\n         */\n        self.bindTo = function bindTo($el) {\n            bindToElement($el);\n            createModel();\n            createView();\n            createRenderer();\n            observeModel();\n            $el.data('paginator', pub);\n        };\n    }\n\n    $.fn.paginate = function paginate(opts) {\n        new Paginator(opts).bindTo(this);\n    };\n})();\n"]}